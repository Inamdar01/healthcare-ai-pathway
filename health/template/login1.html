<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Healthcare - Login</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', sans-serif;
        background: #000000;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }

      #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        background: #000000;
        z-index: -1;
      }

      .container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 20px;
        position: relative;
        z-index: 1;
      }

      .hidden {
        display: none !important;
      }

      .glow-button {
        position: relative;
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        border: none;
        border-radius: 50px;
        color: white;
        font-size: 2rem;
        font-weight: bold;
        padding: 20px 60px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 2px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        overflow: hidden;
      }

      .glow-button:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      }

      .auth-container {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 40px;
        width: 100%;
        max-width: 400px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .auth-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .auth-title {
        color: white;
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .auth-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1rem;
      }

      .auth-form {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .form-label {
        color: white;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .form-input {
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 15px;
        color: white;
        font-size: 1rem;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .form-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .form-input:focus {
        outline: none;
        border-color: #4ecdc4;
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .auth-button {
        background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 1.1rem;
        font-weight: bold;
        padding: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 10px;
      }

      .auth-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      }

      .auth-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .auth-switch {
        text-align: center;
        margin-top: 25px;
        color: rgba(255, 255, 255, 0.8);
      }

      .auth-switch-link {
        color: #4ecdc4;
        text-decoration: none;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .auth-switch-link:hover {
        color: #ff6b6b;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
      }

      .error-message {
        background: rgba(255, 107, 107, 0.2);
        border: 1px solid rgba(255, 107, 107, 0.5);
        border-radius: 8px;
        padding: 12px;
        color: #ff6b6b;
        font-size: 0.9rem;
        text-align: center;
        margin-bottom: 20px;
      }

      .success-message {
        background: rgba(78, 205, 196, 0.2);
        border: 1px solid rgba(78, 205, 196, 0.5);
        border-radius: 8px;
        padding: 12px;
        color: #4ecdc4;
        font-size: 0.9rem;
        text-align: center;
        margin-bottom: 20px;
      }

      .admin-link {
        text-align: center;
        margin-top: 15px;
        padding: 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
      }

      .admin-link a {
        color: #feca57;
        text-decoration: none;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .admin-link a:hover {
        color: #ff6b6b;
      }
    </style>
  </head>
  <body>
    <div id="particles-js"></div>

    <div class="container" id="initialScreen">
      <button id="clickableButton" class="glow-button">START</button>
    </div>

    <div class="container hidden" id="authScreen">
      <div class="auth-container">
        <div class="auth-header">
          <h1 class="auth-title" id="authTitle">Login</h1>
          <p class="auth-subtitle" id="authSubtitle">Welcome back to AI Healthcare</p>
        </div>

        <div id="messageContainer"></div>

        <form class="auth-form" id="authForm">
          <div class="form-group hidden" id="nameGroup">
            <label class="form-label" for="name">Full Name</label>
            <input class="form-input" type="text" id="name" name="name" placeholder="Enter your full name">
          </div>

          <div class="form-group">
            <label class="form-label" for="email">Email</label>
            <input class="form-input" type="email" id="email" name="email" placeholder="Enter your email" required>
          </div>

          <div class="form-group">
            <label class="form-label" for="password">Password</label>
            <input class="form-input" type="password" id="password" name="password" placeholder="Min 8 chars with number & symbol" required>
          </div>

          <div class="form-group hidden" id="confirmPasswordGroup">
            <label class="form-label" for="confirmPassword">Confirm Password</label>
            <input class="form-input" type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm your password">
          </div>

          <button type="submit" class="auth-button" id="authSubmitBtn">Login</button>
        </form>

        <div class="auth-switch">
          <span id="switchText">Don't have an account?</span>
          <a class="auth-switch-link" id="switchLink">Register here</a>
        </div>

        <div class="admin-link">
          <a href="admin.html">üîê Admin Dashboard</a>
        </div>
      </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    
    <script>
          const firebaseConfig = {
        apiKey: "AIzaSyA0FwyvLAtL2OV0DHdzmhZPgzurn0GwubU",
        authDomain: "ai-healthcare-dd4da.firebaseapp.com",
        projectId: "ai-healthcare-dd4da",
        storageBucket: "ai-healthcare-dd4da.firebasestorage.app",
        messagingSenderId: "811932137178",
        appId: "1:811932137178:web:5fd25a14f8bb556e4857e3",
        measurementId: "G-C08EYLKX26"
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      particlesJS("particles-js", {
        particles: {
          number: { value: 80, density: { enable: true, value_area: 800 } },
          color: { value: "#ffffff" },
          shape: { type: "circle" },
          opacity: { value: 0.5, random: false },
          size: { value: 3, random: true },
          line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 },
          move: { enable: true, speed: 6, direction: "none", random: false, straight: false, out_mode: "out", bounce: false }
        },
        interactivity: {
          detect_on: "canvas",
          events: { onhover: { enable: true, mode: "repulse" }, onclick: { enable: true, mode: "push" }, resize: true }
        },
        retina_detect: true
      });

      const screens = {
        initial: document.getElementById('initialScreen'),
        auth: document.getElementById('authScreen')
      };

      const authForm = document.getElementById('authForm');
      const authTitle = document.getElementById('authTitle');
      const authSubtitle = document.getElementById('authSubtitle');
      const authSubmitBtn = document.getElementById('authSubmitBtn');
      const switchText = document.getElementById('switchText');
      const switchLink = document.getElementById('switchLink');
      const nameGroup = document.getElementById('nameGroup');
      const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
      const messageContainer = document.getElementById('messageContainer');

      let isLoginMode = true;

      function showScreen(screenName) {
        Object.values(screens).forEach(screen => screen.classList.add('hidden'));
        screens[screenName].classList.remove('hidden');
      }

      function showMessage(message, type = 'error') {
        messageContainer.innerHTML = `<div class="${type}-message">${message}</div>`;
        setTimeout(() => {
          messageContainer.innerHTML = '';
        }, 5000);
      }

      function switchAuthMode() {
        isLoginMode = !isLoginMode;
        
        if (isLoginMode) {
          authTitle.textContent = 'Login';
          authSubtitle.textContent = 'Welcome back to AI Healthcare';
          authSubmitBtn.textContent = 'LOGIN';
          switchText.textContent = "Don't have an account?";
          switchLink.textContent = 'Register here';
          nameGroup.classList.add('hidden');
          confirmPasswordGroup.classList.add('hidden');
        } else {
          authTitle.textContent = 'Register';
          authSubtitle.textContent = 'Join AI Healthcare today';
          authSubmitBtn.textContent = 'REGISTER';
          switchText.textContent = 'Already have an account?';
          switchLink.textContent = 'Login here';
          nameGroup.classList.remove('hidden');
          confirmPasswordGroup.classList.remove('hidden');
        }
        
        messageContainer.innerHTML = '';
        authForm.reset();
      }

      function validatePassword(password) {
        const minLength = password.length >= 8;
        const hasNumber = /\d/.test(password);
        const hasSymbol = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password);
        return minLength && hasNumber && hasSymbol;
      }

      async function handleAuth(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const name = document.getElementById('name').value.trim();
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (!validatePassword(password)) {
          showMessage('Password must be at least 8 characters long and include a number and a symbol.');
          return;
        }

        authSubmitBtn.disabled = true;
        authSubmitBtn.textContent = 'Processing...';

        try {
          if (isLoginMode) {
            // Login
            const userCredential = await auth.signInWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            // Get user data from Firestore
            const userDoc = await db.collection('users').doc(user.uid).get();
            const userData = userDoc.data();
            
            // Store in localStorage
            localStorage.setItem('currentUser', JSON.stringify({
              uid: user.uid,
              email: user.email,
              name: userData.name,
              role: userData.role || 'user'
            }));

            // Log login activity
            await db.collection('users').doc(user.uid).update({
              lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
              loginCount: firebase.firestore.FieldValue.increment(1)
            });

            showMessage('Login successful! Redirecting...', 'success');
            setTimeout(() => {
              window.location.href = 'admin.html';
            }, 1500);
          } else {
            // Register
            if (password !== confirmPassword) {
              showMessage('Passwords do not match.');
              authSubmitBtn.disabled = false;
              authSubmitBtn.textContent = 'REGISTER';
              return;
            }

            if (!name) {
              showMessage('Please enter your full name.');
              authSubmitBtn.disabled = false;
              authSubmitBtn.textContent = 'REGISTER';
              return;
            }

            // Create user
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;

            // Save user data to Firestore
            await db.collection('users').doc(user.uid).set({
              name: name,
              email: email,
              role: 'user',
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
              loginCount: 1,
              isActive: true
            });

            showMessage('Registration successful! You can now login.', 'success');
            setTimeout(() => {
              switchAuthMode();
              authSubmitBtn.disabled = false;
            }, 2000);
          }
        } catch (error) {
          console.error('Auth error:', error);
          let errorMessage = 'An error occurred. Please try again.';
          
          if (error.code === 'auth/email-already-in-use') {
            errorMessage = 'An account with this email already exists.';
          } else if (error.code === 'auth/wrong-password') {
            errorMessage = 'Invalid email or password.';
          } else if (error.code === 'auth/user-not-found') {
            errorMessage = 'No account found with this email.';
          } else if (error.code === 'auth/weak-password') {
            errorMessage = 'Password is too weak. Please use a stronger password.';
          }
          
          showMessage(errorMessage);
          authSubmitBtn.disabled = false;
          authSubmitBtn.textContent = isLoginMode ? 'LOGIN' : 'REGISTER';
        }
      }

      document.getElementById('clickableButton').addEventListener('click', () => {
        showScreen('auth');
      });

      switchLink.addEventListener('click', switchAuthMode);
      authForm.addEventListener('submit', handleAuth);
    </script>
  </body>
</html>